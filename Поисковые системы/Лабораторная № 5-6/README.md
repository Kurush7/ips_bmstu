# Лабораторная №5-6 [GPT-говорилка]

### ~~Оглавление~~ Последовательность действий:
- загрузка модели нейросети с помощью библиотеки transformers
- дообучение модели на собственном наборе данных
- подбор оптимальных параметров для генерации

А теперь по-очереди про последние два пункта.

### Fine-tuning

Для продолжения сетью была выбрана следующая фраза
из творчества М. Фрая:
```
Любить незнакомые города легко – мы принимаем их такими, какие они есть, и не требуем ничего, кроме новых впечатлений.
```

Без дообучения сеть очень хорошо реагирет на любовь и города и быстро скатывается во что-то одно, например:
```
Любить незнакомые города легко – мы принимаем их такими, какие они есть,
и не требуем ничего, кроме новых впечатлений. А вот как полюбить себя?
Продается комната в 2 к-тиэтажном доме на 6м этаже.
Площадь комнаты 22 кв.метра. Комната находится на первом этаже, а кухня - на 4-м.
На кухне есть плита, холодильник, микроволн. Окна пластиковые стеклопакеты.
Рядом расположена сауна. Цена за 1кв.метр 65000 рублей. Торг уместен! 8-909-505-52-70
 Продается помещение
```

Или еще например, где в конце оно вообще ушло глубоко в себя:
```
Любить незнакомые города легко – мы принимаем их такими, какие они есть, и не требуем ничего, кроме новых впечатлений.
Если вы никогда раньше не путешествовали автостопом или по железной дороге, то самое время познакомиться со столицей Беларуси – городом Минск.
Прогуляйтесь по его улицам и загляните на один из самых необычных рынков Европы.
Вы увидите множество интересных экспонатов: старинные книги, посуду, одежду и многое другое. Не забудьте приобрести сувениры для родных и друзей.
К сожалению, ваш браузер не поддерживает JavaScript. Пожалуйста, обновите ваш браузер или включите поддержку JavaScript для коррек
```

Поэтому собран небольшой набор цитат за авторством того же автора, что и используемый prompt (см. файл ```train.txt```), на котором модель дообучалась. В результате попытки свернуть модель с испорченного пути квартирного вопроса на путь философствования увенчался относительным успехом, например:
```
Любить незнакомые города легко – мы принимаем их такими, какие они есть, и не требуем ничего, кроме новых впечатлений. Путешествовать же нам приходится часто – такова уж наша жизнь. Не в наших интересах бороться за место под солнцем, околачиваться в окрестностях сомнительных достопримечательностей и бесцельно тратить время.

Мы слишком стары, чтобы гоняться за призраками. Нам вполне достаточно просто жить. И с этим ничего не поделаешь.

Слепое принятие фактов – вот единственное, что нам остается. Безмятежное следование им – вот лучшее, что мы можем себе позволить.

```

Или вот:
```
Любить незнакомые города легко – мы принимаем их такими, какие они есть, и не требуем ничего, кроме новых впечатлений. Но полюбить свою Родину – совсем другое дело.

Я так часто бывал в чужих странах, открывал для себя все новое и непривычное, что теперь с огромным удовольствием возвращаюсь домой. Мне не хочется уезжать, не повидав старых знакомых – тех, с кем мне довелось вместе служить, закончить институт и встретить старость.

Возвращаясь из отпуска, я всегда мысленно возвращаюсь в те места, где побывал. Безграничное счастье побывать там, где ты еще ни разу не был!
```

Можно заметить, что он по крайней мере пытается поддерживать исходную тему, но при этом слишком хорошо усвоил из тренировочного мини-сета, что общаться надо короткими фразами с пробелом между ними... :)

### Paramenter-tuning
В результате не слишком продолжительных и утомительных поисков был выбран следующий набор параметров генерации:
- max_new_tokens=100 - допустимое число токенов генерации (больше 50 на GPU не лезло, поэтому долго и больно)
- top_k=10 - выбор из топа наиболее вероятных слов
- temperature=5.0 - к вопросу о вероятностях выбора слов с не самой высокой уверенностью
- repetition_penalty=2.5 - нехорошо, когда часто повторяет слова (а были случаи, когда вообще скатывался в бесконечный повтор одного и того же слова)
- num_beams=20 - местный аналог фильтра частиц, он же древовидный поиск с "методом ветвей и границ", в котором постоянно поддерживаем набор актуальных текстов и расширяем его, оставляя лишь наиболее вероятные

Напоследок - примеры **не самых качественных** генераций при плохих параметрах (в предыдущем разделе использовались параметры, определенные выше ):
```
[top_k=0] Любить незнакомые города легко – мы принимаем их такими, какие они есть, и не требуем ничего, кроме новых впечатлений. Путешествовать же – это всегда риск, неизвестность, непрерывный бег от одного конца города к другому, и в этом бегстве нельзя приу домашнего останавливаться, нельзя принастраиваться и бороться со своими страхами. Ведь город – это всегда толпа, и в толпе всегда полно народу.

Сначала я жила в большом городе, в том городе, куда так мечтают уехать все мальчишки – на поезде, в троллейбусе, в ракете. Потом я поехала на поезде в другой город – сначала
```

И еще:
```
[top_k=100] Любить незнакомые города легко – мы принимаем их такими, какие они есть, и не требуем ничего, кроме новых впечатлений. Но полюбить свое Отечество – гораздо труднее. Утратив это чувство, очень трудно возродиться, найти себя в жизни. Без любви к Отчизне нет человека, и только потеряв это чувство, мы начинаем понимать, что такое Родина, и кто мы такие есть. Без любви к своему Отчизне нет истинного патриотизма, нет любви к своей истории, нет уважения к своей Отчизне - ни морального, ни религиозного, ни какого-либо иного. Без этой любви не
```